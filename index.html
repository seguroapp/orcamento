<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orçamento Visual CFTV - TypeScript</title>
    
    <!-- Tailwind CSS para design responsivo -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Estilos personalizados -->
    <link rel="stylesheet" href="css/style.css">
</head>
<body class="p-4 md:p-8">

    <!-- Cabeçalho da Aplicação -->
    <header class="header text-center mb-8">
        <h1 class="text-3xl font-extrabold text-indigo-700">Gerador de Orçamento Visual CFTV</h1>
        <p class="text-gray-600 mt-1">Versão TypeScript - Profissional e Moderna</p>
    </header>

    <!-- Container Principal -->
    <div class="container mx-auto">

        <!-- Controles Superiores -->
        <div class="controls-panel bg-white p-6 rounded-lg shadow-md mb-6">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                
                <!-- Seleção de Modo -->
                <div class="mode-selector">
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Modo de Edição</label>
                    <div class="grid grid-cols-2 gap-2">
                        <button id="selectMode" class="tool-btn p-2 bg-indigo-500 text-white rounded-lg hover:bg-indigo-600 transition text-sm">
                            Selecionar
                        </button>
                        <button id="cameraMode" class="tool-btn p-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition text-sm">
                            Câmera
                        </button>
                        <button id="wallMode" class="tool-btn p-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition text-sm">
                            Parede
                        </button>
                        <button id="deleteMode" class="tool-btn p-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition text-sm">
                            Excluir
                        </button>
                    </div>
                </div>

                <!-- Tipo de Câmera -->
                <div class="camera-type-selector">
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Tipo de Câmera</label>
                    <select id="cameraType" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                        <option value="dome">DOME (Interna)</option>
                        <option value="bullet">BULLET (Externa)</option>
                        <option value="ptz">PTZ (Giratória)</option>
                        <option value="fisheye">FISHEYE (360°)</option>
                    </select>
                </div>

                <!-- Ações Rápidas -->
                <div class="quick-actions">
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Ações</label>
                    <div class="flex space-x-2">
                        <button id="clearCanvas" class="flex-1 p-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition">
                            Limpar
                        </button>
                        <button id="exportCanvas" class="flex-1 p-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition">
                            Exportar
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Layout Principal - Canvas e Orçamento -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            
            <!-- Área do Canvas -->
            <div class="canvas-section bg-white rounded-lg shadow-md p-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4">Mapa do Projeto</h2>
                
                <!-- Canvas Container -->
                <div class="canvas-container relative border-2 border-gray-200 rounded-lg overflow-hidden">
                    <canvas id="mapCanvas" width="800" height="450" 
                            class="block w-full h-auto cursor-crosshair">
                        Seu navegador não suporta canvas HTML5.
                    </canvas>
                    
                    <!-- Canvas Overlay para informações -->
                    <div id="canvasInfo" class="absolute top-2 left-2 bg-black bg-opacity-50 text-white text-xs p-2 rounded hidden">
                        <div id="mouseCoords">X: 0, Y: 0</div>
                        <div id="cameraCount">Câmeras: 0</div>
                    </div>
                </div>

                <!-- Instruções -->
                <div id="modeInstructions" class="mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                    <p class="text-sm text-blue-800">
                        Clique para selecionar e mover câmeras.
                    </p>
                </div>

                <!-- Controles da Câmera Selecionada -->
                <div id="cameraControls" class="mt-4 p-4 bg-gray-50 border border-gray-200 rounded-lg hidden">
                    <h3 class="text-lg font-semibold text-gray-800 mb-3">Controles da Câmera</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Posição -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Posição</label>
                            <div class="grid grid-cols-2 gap-2">
                                <div>
                                    <label class="text-xs text-gray-600">X:</label>
                                    <input type="number" id="cameraX" min="0" max="800" 
                                           class="w-full p-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-indigo-500">
                                </div>
                                <div>
                                    <label class="text-xs text-gray-600">Y:</label>
                                    <input type="number" id="cameraY" min="0" max="450" 
                                           class="w-full p-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-indigo-500">
                                </div>
                            </div>
                        </div>

                        <!-- Ângulo de Visão -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Ângulo de Visão: <span id="angleValue">90°</span>
                            </label>
                            <input type="range" id="cameraAngle" min="30" max="180" value="90" step="15"
                                   class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider">
                        </div>

                        <!-- Alcance -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Alcance: <span id="rangeValue">50px</span>
                            </label>
                            <input type="range" id="cameraRange" min="20" max="100" value="50" step="5"
                                   class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider">
                        </div>

                        <!-- Rotação -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Rotação: <span id="rotationValue">0°</span>
                            </label>
                            <input type="range" id="cameraRotation" min="0" max="360" value="0" step="15"
                                   class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider">
                        </div>
                    </div>

                    <!-- Botões de Ação -->
                    <div class="flex space-x-2 mt-4">
                        <button id="updateCamera" class="flex-1 p-2 bg-indigo-500 text-white rounded-lg hover:bg-indigo-600 transition text-sm">
                            Aplicar Mudanças
                        </button>
                        <button id="deleteCamera" class="flex-1 p-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition text-sm">
                            Remover Câmera
                        </button>
                    </div>
                </div>
            </div>

            <!-- Área do Orçamento -->
            <div class="budget-section bg-white rounded-lg shadow-md p-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold text-gray-800">Lista de Orçamento</h2>
                    <button id="addBudgetItem" class="p-2 bg-indigo-500 text-white rounded-lg hover:bg-indigo-600 transition">
                        + Adicionar Item
                    </button>
                </div>

                <!-- Lista de Itens -->
                <div id="budgetList" class="space-y-3 mb-4 max-h-64 overflow-y-auto">
                    <!-- Itens serão inseridos dinamicamente aqui -->
                </div>

                <!-- Total -->
                <div class="border-t pt-4">
                    <div class="flex justify-between items-center text-lg font-bold">
                        <span>Total do Investimento:</span>
                        <span id="totalBudget" class="text-indigo-600">R$ 0,00</span>
                    </div>
                </div>

                <!-- Botão de Gerar Proposta -->
                <button id="generateProposal" class="w-full mt-4 p-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition font-semibold">
                    Gerar Proposta Comercial
                </button>

                <!-- Botão de Configurar Dados -->
                <button id="configureProposal" class="w-full mt-2 p-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition text-sm">
                    Configurar Dados da Proposta
                </button>
            </div>
        </div>
    </div>

    <!-- Modal para Adicionar/Editar Item do Orçamento -->
    <div id="budgetModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg p-6 w-full max-w-md mx-4">
            <h3 id="modalTitle" class="text-lg font-bold text-gray-800 mb-4">Adicionar Item ao Orçamento</h3>
            
            <form id="budgetForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-1">Descrição</label>
                    <input type="text" id="itemDescription" 
                           class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" 
                           placeholder="Ex: Câmera IP Dome" required>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">Quantidade</label>
                        <input type="number" id="itemQuantity" min="1" value="1"
                               class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" required>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">Preço Unitário (R$)</label>
                        <input type="number" id="itemPrice" min="0" step="0.01" value="0.00"
                               class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" required>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-1">Categoria</label>
                    <select id="itemCategory" 
                            class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" required>
                        <option value="camera">Câmeras</option>
                        <option value="cable">Cabos e Conectores</option>
                        <option value="equipment">Equipamentos</option>
                        <option value="installation">Instalação</option>
                        <option value="other">Outros</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-1">Especificações (Opcional)</label>
                    <textarea id="itemSpecs" rows="3"
                              class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" 
                              placeholder="Detalhes técnicos ou observações..."></textarea>
                </div>

                <!-- Botões do Modal -->
                <div class="flex space-x-3 pt-4">
                    <button type="button" id="cancelModal" 
                            class="flex-1 bg-gray-300 text-gray-700 p-2 rounded-lg hover:bg-gray-400 transition">
                        Cancelar
                    </button>
                    <button type="submit" id="saveBudgetItem"
                            class="flex-1 bg-indigo-500 text-white p-2 rounded-lg hover:bg-indigo-600 transition">
                        Salvar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal para Configurar Dados da Proposta -->
    <div id="proposalConfigModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg p-6 w-full max-w-2xl mx-4 max-h-screen overflow-y-auto">
            <h3 class="text-lg font-bold text-gray-800 mb-4">Configurar Dados da Proposta</h3>
            
            <form id="proposalConfigForm" class="space-y-6">
                <!-- Dados da Empresa -->
                <div class="border rounded-lg p-4">
                    <h4 class="font-semibold text-gray-700 mb-3">Dados da Empresa:</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Nome da Empresa</label>
                            <input type="text" id="configCompanyName" 
                                   class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" 
                                   placeholder="Sua Empresa de Segurança Eletrônica">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Telefone</label>
                            <input type="text" id="configCompanyPhone" 
                                   class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" 
                                   placeholder="(11) 99999-9999">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">E-mail</label>
                            <input type="email" id="configCompanyEmail" 
                                   class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" 
                                   placeholder="contato@empresa.com.br">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">CNPJ</label>
                            <input type="text" id="configCompanyCNPJ" 
                                   class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" 
                                   placeholder="00.000.000/0001-00">
                        </div>
                    </div>
                </div>

                <!-- Dados do Cliente -->
                <div class="border rounded-lg p-4">
                    <h4 class="font-semibold text-gray-700 mb-3">Dados do Cliente:</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Nome/Empresa</label>
                            <input type="text" id="configClientName" 
                                   class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" 
                                   placeholder="Nome ou Razão Social">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">CPF/CNPJ</label>
                            <input type="text" id="configClientDocument" 
                                   class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" 
                                   placeholder="000.000.000-00">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Telefone</label>
                            <input type="text" id="configClientPhone" 
                                   class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" 
                                   placeholder="(11) 99999-9999">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">E-mail</label>
                            <input type="email" id="configClientEmail" 
                                   class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" 
                                   placeholder="cliente@email.com">
                        </div>
                    </div>
                    <div class="mt-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Endereço Completo</label>
                        <textarea id="configClientAddress" rows="2"
                                  class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" 
                                  placeholder="Rua, nº, bairro, cidade, CEP"></textarea>
                    </div>
                </div>

                <!-- Configurações da Proposta -->
                <div class="border rounded-lg p-4">
                    <h4 class="font-semibold text-gray-700 mb-3">Configurações da Proposta:</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Validade (dias)</label>
                            <input type="number" id="configProposalValidity" min="1" max="90" value="15"
                                   class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Prazo de Entrega</label>
                            <input type="text" id="configDeliveryTime" 
                                   class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" 
                                   placeholder="5 a 10 dias úteis" value="5 a 10 dias úteis">
                        </div>
                    </div>
                </div>

                <!-- Botões do Modal -->
                <div class="flex space-x-3 pt-4">
                    <button type="button" id="cancelProposalConfig" 
                            class="flex-1 bg-gray-300 text-gray-700 p-2 rounded-lg hover:bg-gray-400 transition">
                        Cancelar
                    </button>
                    <button type="submit" id="saveProposalConfig"
                            class="flex-1 bg-indigo-500 text-white p-2 rounded-lg hover:bg-indigo-600 transition">
                        Salvar Configurações
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Seção de Proposta Comercial (Visível apenas na impressão) -->
    <div id="proposalSection" class="proposal-print-only" style="display: none;">
        <!-- Cabeçalho da Proposta -->
        <div class="proposal-header text-center mb-6">
            <h1 class="text-2xl font-bold text-indigo-800 mb-2">PROPOSTA COMERCIAL</h1>
            <h2 class="text-lg font-semibold text-gray-700">Sistema de CFTV - Circuito Fechado de TV</h2>
            <div class="border-b-2 border-indigo-200 mt-4"></div>
        </div>

        <!-- Informações da Empresa -->
        <div class="company-info bg-gray-50 p-4 rounded-lg mb-6">
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <h3 class="font-semibold text-gray-800 mb-2">Dados da Empresa:</h3>
                    <p><strong>Empresa:</strong> <span id="proposalCompanyName">Sua Empresa de Segurança Eletrônica</span></p>
                    <p><strong>Telefone:</strong> <span id="proposalCompanyPhone">(11) 99999-9999</span></p>
                    <p><strong>E-mail:</strong> <span id="proposalCompanyEmail">contato@empresa.com.br</span></p>
                </div>
                <div>
                    <h3 class="font-semibold text-gray-800 mb-2">Dados da Proposta:</h3>
                    <p><strong>Data:</strong> <span id="proposalDate"></span></p>
                    <p><strong>Proposta Nº:</strong> <span id="proposalNumber"></span></p>
                    <p><strong>Validade:</strong> <span id="proposalValidity">15 dias</span></p>
                </div>
            </div>
        </div>

        <!-- Dados do Cliente -->
        <div class="client-info bg-indigo-50 p-4 rounded-lg mb-6">
            <h3 class="font-semibold text-indigo-800 mb-3">Dados do Cliente:</h3>
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <p><strong>Nome/Empresa:</strong> <span id="clientName">_________________________</span></p>
                    <p><strong>CNPJ/CPF:</strong> <span id="clientDocument">_________________________</span></p>
                </div>
                <div>
                    <p><strong>Telefone:</strong> <span id="clientPhone">_________________________</span></p>
                    <p><strong>E-mail:</strong> <span id="clientEmail">_________________________</span></p>
                </div>
            </div>
            <p class="mt-2"><strong>Endereço:</strong> <span id="clientAddress">_________________________________________________________</span></p>
        </div>

        <!-- Projeto Visual -->
        <div class="project-visual mb-6">
            <h3 class="font-semibold text-gray-800 mb-3">Layout do Projeto:</h3>
            <div class="canvas-print-container border-2 border-gray-300 rounded-lg p-4 bg-white">
                <canvas id="printCanvas" width="800" height="450" class="w-full border rounded"></canvas>
                <p class="text-sm text-gray-600 mt-2 text-center">
                    Disposição das câmeras conforme projeto elaborado
                </p>
            </div>
        </div>

        <!-- Lista de Itens do Orçamento -->
        <div class="budget-section mb-6">
            <h3 class="font-semibold text-gray-800 mb-3">Discriminação dos Itens:</h3>
            <table class="w-full border-collapse border border-gray-300">
                <thead>
                    <tr class="bg-gray-100">
                        <th class="border border-gray-300 p-2 text-left">Item</th>
                        <th class="border border-gray-300 p-2 text-left">Descrição</th>
                        <th class="border border-gray-300 p-2 text-center">Qtd</th>
                        <th class="border border-gray-300 p-2 text-right">Valor Unit.</th>
                        <th class="border border-gray-300 p-2 text-right">Valor Total</th>
                    </tr>
                </thead>
                <tbody id="proposalBudgetTable">
                    <!-- Itens serão inseridos aqui -->
                </tbody>
            </table>
        </div>

        <!-- Total do Investimento -->
        <div class="total-section mb-6">
            <div class="total-investimento text-center">
                <h3 class="text-lg font-bold text-indigo-800 mb-2">VALOR TOTAL DO INVESTIMENTO</h3>
                <div class="text-3xl font-bold text-indigo-900" id="proposalTotalValue">R$ 0,00</div>
            </div>
        </div>

        <!-- Especificações Técnicas -->
        <div class="specs-section mb-6">
            <h3 class="font-semibold text-gray-800 mb-3">Especificações Técnicas:</h3>
            <div class="bg-gray-50 p-4 rounded-lg">
                <ul class="list-disc ml-6 space-y-1 text-sm">
                    <li>Câmeras IP com resolução Full HD (1080p)</li>
                    <li>Gravador NVR com armazenamento em HD</li>
                    <li>Visualização remota via aplicativo móvel</li>
                    <li>Gravação contínua e por detecção de movimento</li>
                    <li>Backup automático e manual dos vídeos</li>
                    <li>Sistema de alarme integrado</li>
                    <li>Garantia de 12 meses para equipamentos</li>
                    <li>Suporte técnico especializado</li>
                </ul>
            </div>
        </div>

        <!-- Termos e Condições -->
        <div class="terms-section mb-6">
            <h3 class="font-semibold text-gray-800 mb-3">Condições Comerciais:</h3>
            <div class="text-sm space-y-2">
                <p><strong>Forma de Pagamento:</strong> À vista com desconto ou parcelado conforme negociação</p>
                <p><strong>Prazo de Entrega:</strong> 5 a 10 dias úteis após confirmação do pedido</p>
                <p><strong>Instalação:</strong> Incluída no valor, realizada por técnicos especializados</p>
                <p><strong>Garantia:</strong> 12 meses para equipamentos e 6 meses para serviços</p>
                <p><strong>Validade da Proposta:</strong> 15 dias corridos</p>
            </div>
        </div>

        <!-- Observações -->
        <div class="observations-section mb-6">
            <h3 class="font-semibold text-gray-800 mb-3">Observações Importantes:</h3>
            <div class="text-sm bg-yellow-50 p-4 rounded-lg">
                <ul class="list-disc ml-6 space-y-1">
                    <li>Os preços estão sujeitos a alteração sem aviso prévio</li>
                    <li>Frete não incluso (será calculado conforme localização)</li>
                    <li>Instalação em locais de difícil acesso pode ter custo adicional</li>
                    <li>Infraestrutura elétrica e de rede por conta do cliente</li>
                    <li>Projeto sujeito a visita técnica para confirmação</li>
                </ul>
            </div>
        </div>

        <!-- Rodapé da Proposta -->
        <div class="proposal-footer text-center border-t-2 border-indigo-200 pt-4">
            <p class="text-sm text-gray-600">
                Agradecemos a oportunidade de apresentar esta proposta.<br>
                Estamos à disposição para esclarecimentos adicionais.
            </p>
            <div class="mt-4 text-xs text-gray-500">
                Documento gerado automaticamente pelo Sistema CFTV Visual Budget
            </div>
        </div>
    </div>

    <!-- Scripts da Aplicação - TypeScript via Vite -->
    <script type="module" src="/src/main.ts"></script>

</body>
</html>